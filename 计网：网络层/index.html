<!DOCTYPE html>
<html 
	lang="zh_CN">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		
<link rel="stylesheet" href="/kirameki/css/layout.css">

		
		<title> 计网：网络层 -  Wandern</title>
		<link rel="stylesheet" href="https://unpkg.com/mdui@1.0.2/dist/css/mdui.min.css" />
		<script src="https://unpkg.com/mdui@1.0.2/dist/js/mdui.min.js"></script>
		<!-- lazyload -->
		<script src="https://unpkg.com/lazysizes@5.1.0/lazysizes.min.js"></script>
		<!-- smooth-scrolling -->
		<script src="https://unpkg.com/smooth-scrolling.js@1.0.0"></script>
		<!-- highlight -->
		<link rel="stylesheet" href="//unpkg.com/@highlightjs/cdn-assets@11.6.0/styles/atom-one-dark.min.css" />
		<script src="//unpkg.com/@highlightjs/cdn-assets@11.6.0/highlight.min.js"></script>
		<!-- 预置 kiraicon -->
		<link rel="stylesheet" href="/kirameki/lib/iconfont/iconfont.css" crossorigin />
		
			<link rel="stylesheet" href="//at.alicdn.com/t/font_3299330_el19bsi97h8.css" crossorigin />
		
		<link rel="stylesheet" href="/kirameki/lib/iconfont/iconfont.css" crossorigin />
		<link
			rel="shortcut icon"
			href="https://cdn.jsdelivr.net/gh/WandernForte/roselia/favicon.png"
			type="image/png"
		/>
		<link rel="stylesheet" href="/kirameki/deps/css/APlayer.min.css">
		
		<script src="/kirameki/deps/js/APlayer.min.js"></script>
		<script src="/kirameki/deps/js/Meting.min.js"></script>
	<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head>

	<body>
		<div
			class="kira-background"
			style="background-image: url('https://cdn.jsdelivr.net/gh/WandernForte/roselia/bkg.jpg')"
		></div>
		<div class="kira-header">
    <a
        class="kira-drawer-button mdui-ripple"
        title="导航栏"
        onclick="document.querySelector('.kira-sidebar-modal').classList.add('show');document.querySelector('.kira-sidebar#sidebar').classList.add('show');"
    >
        <i class="kirafont icon-menu"></i>
    </a>
    <a href="/" title="Wandern">
        <img
			src="https://wandernforte.github.io/kirameki/images/SD102F.png"
			alt="Kiryu Sento"
		/>
    </a>
</div>
		<div class="kira-body">
			<div class="kira-sidebar" id="sidebar">
	<div class="kira-avatar mdui-ripple">
		<a href="https://wandernforte.github.io/kirameki/images/SD102F.png" title="Kiryu Sento">
			<img
				src="https://wandernforte.github.io/kirameki/images/SD102F.png"
				alt="Kiryu Sento"
			/>
		</a>
	</div>
	<div class="kira-count">
		<div><span>文章</span>28</div>
		<div><span>标签</span>9</div>
		<div><span>分类</span>4</div>
	</div>
	<div class="kira-list">
		
		<a
			class="kira-list-item mdui-ripple false"
			href="/kirameki/"
			title="回到首页"
		>
			<i
				class="kirafont icon-home"
			></i>
			<div class="kira-list-item-content">回到首页</div>
		</a>
		
		<a
			class="kira-list-item mdui-ripple false"
			href="/kirameki/Archive.html"
			title="文章归档"
		>
			<i
				class="kirafont icon-container"
			></i>
			<div class="kira-list-item-content">文章归档</div>
		</a>
		
		<a
			class="kira-list-item mdui-ripple false"
			href="/kirameki/about.html"
			title="关于本人"
		>
			<i
				class="kirafont icon-user"
			></i>
			<div class="kira-list-item-content">关于本人</div>
		</a>
		
		<a
			class="kira-list-item mdui-ripple false"
			href="/kirameki/friends.html"
			title="我的朋友"
		>
			<i
				class="kirafont icon-team"
			></i>
			<div class="kira-list-item-content">我的朋友</div>
		</a>
		
	</div>
	<aside id="kira-sidebar">
		 <div class="kira-widget-wrap">
	<div class="kira-widget kira-social">
		<a
			class="mdui-ripple"
			href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=1648639935&website=www.oicqzone.com"
			target="_blank"
			mdui-tooltip="{content: 'QQ'}"
			style="
				color: rgb(49, 174, 255);
				background-color: rgba(49, 174, 255, .1);
			"
		>
			<i
				class="kirafont icon-QQ"
			></i> </a
		><a
			class="mdui-ripple"
			href="https://space.bilibili.com/57486455"
			target="_blank"
			mdui-tooltip="{content: '哔哩哔哩'}"
			style="
				color: rgb(231, 106, 141);
				background-color: rgba(231, 106, 141, .15);
			"
		>
			<i
				class="kirafont icon-bilibili"
			></i> </a
		><a
			class="mdui-ripple"
			href="https://github.com/WandernForte/"
			target="_blank"
			mdui-tooltip="{content: 'GitHub'}"
			style="
				color: rgb(25, 23, 23);
				background-color: rgba(25, 23, 23, .15);
			"
		>
			<i
				class="kirafont icon-github"
			></i> </a
		><a
			class="mdui-ripple"
			href="https://gitee.com/sento1926"
			target="_blank"
			mdui-tooltip="{content: 'Gitee'}"
			style="
				color: rgb(165, 15, 15);
				background-color: rgba(165, 15, 15, .15);
			"
		>
			<i
				class="kirafont icon-gitee"
			></i> </a
		>
	</div>
</div>
  
<div class="kira-widget-wrap">
  <h3 class="kira-widget-title">分类</h3>
  <div class="kira-widget">

    <ul class="category-list">

      


      

      

      <li class="category-list-item">
        <a class="category-list-link" href="/kirameki/categories/CSAPP/">CSAPP</a>
        <span class="category-list-count">6</span>
      </li>

      

      <li class="category-list-item">
        <a class="category-list-link" href="/kirameki/categories/Computer-Network/">Computer Network</a>
        <span class="category-list-count">8</span>
      </li>

      

      <li class="category-list-item">
        <a class="category-list-link" href="/kirameki/categories/对抗样本/">对抗样本</a>
        <span class="category-list-count">10</span>
      </li>

      

      <li class="category-list-item">
        <a class="category-list-link" href="/kirameki/categories/网络与系统安全/">网络与系统安全</a>
        <span class="category-list-count">3</span>
      </li>

      
    </ul>

  </div>
</div>
  
<div class="kira-widget-wrap">
	<div id="randomtagcloud" class="kira-widget tagcloud kira-rainbow"><a href="/kirameki/tags/Code/" style="font-size: 10px;">Code</a> <a href="/kirameki/tags/Note/" style="font-size: 20px;">Note</a> <a href="/kirameki/tags/getStarted/" style="font-size: 10px;">getStarted</a> <a href="/kirameki/tags/hw-exam/" style="font-size: 10px;">hw&exam</a> <a href="/kirameki/tags/idea/" style="font-size: 10px;">idea</a> <a href="/kirameki/tags/note/" style="font-size: 16.67px;">note</a> <a href="/kirameki/tags/plan/" style="font-size: 10px;">plan</a> <a href="/kirameki/tags/survey/" style="font-size: 10px;">survey</a> <a href="/kirameki/tags/%E4%BB%A3%E7%A0%81%E6%A8%A1%E6%9D%BF/" style="font-size: 13.33px;">代码模板</a></div>
	
</div>

  
<div class="kira-widget-wrap">
	<h3 class="kira-widget-title">文章归档</h3>
	<div class="kira-widget">
		<ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/kirameki/archives/2023/">2023</a><span class="archive-list-count">28</span></li></ul>
	</div>
</div>

 
	</aside>
	<div class="kira-copyright">
		&copy; 2023
		<a href="/">Kiryu Sento</a
		>
		Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> &
		<!-- TODO: github 链接 -->
		<a href="https://github.com/ch1ny/kira-hexo/" target="_blank">Kira-Hexo</a>
		<br />
		
			<a href="https://beian.miit.gov.cn/" target="_blank">下北泽ICP备114514号-3</a>
		
		
	</div>
</div>
<div class="kira-sidebar-modal" id="sidebar-modal" onclick="(function(self) {
	self.classList.remove('show');
	document.querySelector('.kira-sidebar.show#sidebar').classList.remove('show');
})(this)"></div>
			<div class="kira-content">
				<div id="kira-top-header"></div>
				<div class="kira-main-content">
					
<link rel="stylesheet" href="/kirameki/css/kira-image.css">

<script src="/js/kira-image.js"></script>
<div class="kira-image">
    <div class="kira-image-modal">
        <div class="kira-image-header">
            <div class="kira-image-counter"></div>
            <div class="kira-image-title"></div>
            <div class="kira-image-operation">
                <div class="kira-image-operation-button" id="kira-image-operation-button-zoom">
                    <i class="kirafont icon-zoom-in"></i>
                </div>
                <div class="kira-image-operation-button" id="kira-image-operation-button-close">
                    <i class="kirafont icon-close"></i>
                </div>
            </div>
        </div>
        <div class="kira-image-container">
            <div class="kira-image-prev-button-panel">
                <div class="kira-image-exchange-button">
                    <i class="kirafont icon-left"></i>
                </div>
            </div>
            <div class="kira-image-list">
                <div class="kira-image-prev">
                    <img />
                </div>
                <div class="kira-image-now">
                    <img />
                </div>
                <div class="kira-image-next">
                    <img />
                </div>
            </div>
            <div class="kira-image-next-button-panel">
                <div class="kira-image-exchange-button">
                    <i class="kirafont icon-right"></i>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="kira-post">
	<article>
		
		<div class="kira-post-cover">
			<img
				data-src="https://wandernforte.github.io/kirameki/images/SD302B.png"
				data-sizes="auto"
				alt="计网：网络层"
				class="lazyload kira-post-cover-image disabled-kira-image"
			/>
			<h1>计网：网络层</h1>
		</div>
		
		<div class="kira-post-meta kira-rainbow" style="margin:10px 0!important;">
			<a><i class="kirafont icon-calendar-fill"></i>2023年05月17日</a>
			<a><i class="kirafont icon-areachart"></i>5.9k 字</a>
			<a><i class="kirafont icon-time-circle-fill"></i>大概 24 分钟</a>
		</div>
		<h1><span id="41-网络层的功能">4.1 网络层的功能</span></h1><p><code>无连接，不可靠，传输层负责错误处理</code></p>
<h2><span id="411-异构网络互联">4.1.1 异构网络互联</span></h2><p><strong>中继系统</strong></p>
<ol>
<li>物理层：转发器，集线器</li>
<li>数据链路层：网桥或交换机（分割碰撞域）</li>
<li>网络层：路由器(分割广播域和碰撞域)</li>
<li>网络层以上：网关</li>
</ol>
<p><code>物理层和数据链路层只是把网络扩大，并不能被视为网络互联</code></p>
<p><strong>TCP&#x2F;IP体系的网络互联</strong>：在网络层采用标准化协议（IP），但通过网络层互联的网络可以异构。</p>
<h2><span id="412-路由与转发">4.1.2 路由与转发</span></h2><ul>
<li>路由选择</li>
<li>分组转发</li>
</ul>
<h2><span id="413-sdn软件定义网络">4.1.3 SDN(软件定义网络)</span></h2><ul>
<li>集中式控制层<ul>
<li>控制层集中承担路由选择，下放转发表</li>
</ul>
</li>
<li>分布式数据层（交换结构层）<ul>
<li>数据层的路由器只需收到数据分组，查找转发表、转发数据分组</li>
<li>更新转发表由中央的远程控制器计算</li>
</ul>
</li>
<li>接口开放可编程<ul>
<li>可根据ip, 端口, mac来进行决策</li>
</ul>
</li>
</ul>
<h2><span id="414-拥塞控制">4.1.4 拥塞控制</span></h2><p><strong>如何判断网络是否进入拥塞状态：</strong></p>
<p>网络吞吐量随网络负载的增加而下降，网络就可能进入了拥塞状态</p>
<p><strong>拥塞控制的目的：</strong></p>
<p>获取网络中发生拥塞的信息，从而利用这些信息进行控制，以避免由于拥塞导致的分组丢失，以及严重拥塞导致的死锁问题；确保子网能够承载所达到的流量，仅仅增加资源并不能解决拥塞。</p>
<p><strong>拥塞控制的方法：</strong></p>
<ol>
<li>开环控制<ol>
<li><strong>静态</strong>的预防方法，事先就考虑所有的可能性</li>
<li><strong>做决策时不考虑当前网络状态</strong></li>
<li>准入控制</li>
</ol>
</li>
<li>闭环控制<ol>
<li>事先不考虑发生拥塞的各种因素，采用 <strong>检测网络系统监视以及检测哪里发生拥塞</strong>，然后将拥塞信息传到合适的地方，以调整网络系统的运行。</li>
<li>闭环控制是基于反馈环路的概念，是一种动态的方法。</li>
<li>流量感知路由，流量调节（抑制分组，逐跳背压）</li>
</ol>
</li>
</ol>
<h1><span id="42-路由算法">4.2 路由算法</span></h1><h2><span id="421-静态路由与动态路由">4.2.1 静态路由与动态路由</span></h2><ul>
<li>静态路由算法。指网络管理员手工配置路由信息，且每当网络的拓扑结构或链路状态发生改变时，网络管理员都需要再次修改路由表中相关的静态路由信息。(每次更新都要手动改写)</li>
<li>动态路由算法。路由表项通过路由器之间交换信息，然后根据优化算法得出的。是动态的。</li>
</ul>
<h2><span id="422-距离-向量路由法">4.2.2 距离-向量路由法</span></h2><p><strong>引入数据结构：路由选择表</strong></p>
<ul>
<li>每条路径的目的地，</li>
<li>路径的代价[一般可以用RIP的跳数来衡量]</li>
</ul>
<hr>
<p><strong>路由选择表的更新</strong></p>
<ol>
<li>插入新路由</li>
<li>两节点间存在更短的路由</li>
</ol>
<p><strong>算法实现的实质</strong></p>
<p>迭代计算一条路由的距离，从而优化出最短路径。这一过程需要每个节点在每次更新时都将它的全部路由表发送给所有相邻的结点并整合。因而路径结点越多发送的路由表报文就越大。</p>
<h2><span id="423-链路状态路由算法">4.2.3 链路状态路由算法</span></h2><p><strong>前提条件：</strong>所有结点都具有完全的网络拓扑信息。结点能够主动测试所有邻接节点的状态，同时定期将链路状态传播给<strong>所有</strong>其他结点。</p>
<p><strong>三个特征：</strong></p>
<ul>
<li>向本网络系统中所有的路由器发送信息，这里采用的方法是通过所有端口向所有相邻的路由器发送信息。这些邻接路由器又发送给除先前发送方以外的所有邻接路由器。（邻接路由器间交换的信息是链路状态）</li>
<li>发送的信息是与源路由器邻接的所有路由器的链路状态</li>
<li>只有链路状态发生改变时，路由器才向所有路由器发送此信息</li>
</ul>
<p><strong>优点：</strong></p>
<ul>
<li>计算路径时不再依赖中间结点</li>
<li>链路状态报文不变地传播，可以查找链路上的故障</li>
<li>链路状态报文不随整个链路传播整合，只包含单个节点关于直接链路的信息，其大小与网络中的路由节点数目无关。因而具有更好的规模可伸展性。</li>
</ul>
<h2><span id="424-层次路由分层路由">4.2.4 层次路由（分层路由）</span></h2><p>需要层次路由的理由：网络规模扩大时，路由器的路由表也随之增大，会消耗更多路由器缓冲空间，并且需要更多处理器时间来扫描路由表。</p>
<ul>
<li>内部网关协议（IGP)</li>
<li>外部网关协议（EGP) 不同层次间的协议</li>
</ul>
<p>采用分层路由后，路由器被划分为区域。</p>
<p>每个路由器知道如何将分组路由到自己所在区域内的目标地址，但对于其他区域内的结构毫不知情，即无法自行决定如何路由到其他区域。当不同网络相互连接时，可将每个网络当作一个独立的区域。</p>
<h1><span id="番外-虚电路网络amp数据报网络">番外 虚电路网络&amp;数据报网络</span></h1><p>二者都是分组交换网络</p>
<p>数据报提供网络层无连接服务</p>
<p>通信过程：传输时通过转发表转发分组</p>
<p>虚电路(VC)提供网络层连接服务，每个分组传输占用链路的全部带宽</p>
<p>通信过程：建立(路由)-传输-拆除</p>
<h1><span id="43-ipv4">4.3 IPv4</span></h1><h2><span id="431-ipv4分组">4.3.1 IPv4分组</span></h2><ol>
<li><p>IPv4分组的格式</p>
<ol>
<li>| 首部（20B) | 数据部分 |<ol>
<li><img data-fancybox="gallery" data-sizes="auto" data-src="/kirameki/%E8%AE%A1%E7%BD%91%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%B1%82/ipv4_format.jpeg" alt="ipv4_format" class="lazyload"></li>
<li>版本 ：当前ip协议版本号，4位；ipv4版本号就是4</li>
<li>首部长度：占4位，首部字段以4B为指示单位，最大值是60B，最小值为20B(不使用其他字段)。</li>
<li>总长度：占16位，指示单位为字节。理论数据报的最大总长为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>16</mn></msup><mo>−</mo><mn>1</mn><mo>=</mo><mn>65535</mn><mi>B</mi></mrow><annotation encoding="application/x-tex">2^{16}-1=65535B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.897438em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">6</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord">6</span><span class="mord">5</span><span class="mord">5</span><span class="mord">3</span><span class="mord">5</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span>,但MTU的最大帧为1500B故实际不能超过1500B</li>
<li>标识：占16位，是一个计数器，每产生一个数据报就+1，并赋值给标识字段。是索引但不是序号（用于鉴别是否是同一个数据报）。当数据报因超过MTU限长分片时，来自同一数据报的片需要统一标识</li>
<li>标志：占3位。|无意义（？）|Don’t Fragment|MORE Fragment|</li>
<li>片偏移：占13位，表示当前片在原数据报中的偏移（以8B为单位）</li>
<li>生存时间(TTL)：占8位，表示数据报在网络中可通过的路由器数的最大值，表示分组在网络中的寿命。路由器在转发分组前必须将ttl-1,若TTL为0，则分组必须被丢弃。</li>
<li>协议：占8位，指示使用的数据报为何种协议的数据报，实现复用&#x2F;分解</li>
<li>源地址字段：占4B</li>
<li>目的地址字段：占4B</li>
<li>校验和字段: 每次被路由器转发时都要重新计算一个校验和</li>
</ol>
</li>
<li>IP数据报分片封装数据<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo>=</mo><mfrac><mrow><mi>M</mi><mo>−</mo><mn>20</mn></mrow><mn>8</mn></mfrac><mo>×</mo><mn>8</mn></mrow><annotation encoding="application/x-tex">d = {\frac{M-20}{8}}\times 8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.217331em;vertical-align:-0.345em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">8</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span><span class="mbin mtight">−</span><span class="mord mtight">2</span><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">8</span></span></span></span>（必须是8的整数倍）</li>
<li>最大传输单元MTU</li>
</ol>
<blockquote>
<p>不考虑NAT，ip数据报在整个传输过程中都不会更改源地址和目的地址</p>
</blockquote>
<blockquote>
<p>首部长度如没有指明，默认是20B</p>
</blockquote>
</li>
</ol>
<h2><span id="432-ipv4地址与nat">4.3.2 IPv4地址与NAT</span></h2><ol>
<li><p>IPv4地址</p>
<ol>
<li><p>分类ip地址|冗余|网络号|主机号|</p>
<ol>
<li><p>A	|0|网络号（7）|主机号（24）|</p>
<table>
<thead>
<tr>
<th>网络类别</th>
<th>最大可用网络数</th>
<th>网络最大主机数</th>
</tr>
</thead>
<tbody><tr>
<td>A</td>
<td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>7</mn></msup><mo>−</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">2^7-2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.897438em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">7</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span></span></span></span></td>
<td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>24</mn></msup><mo>−</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">2^{24}-2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.897438em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">4</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span></span></span></span></td>
</tr>
<tr>
<td>B</td>
<td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>14</mn></msup></mrow><annotation encoding="application/x-tex">2^{14}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">4</span></span></span></span></span></span></span></span></span></span></span></span></td>
<td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>16</mn></msup><mo>−</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">2^{16}-2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.897438em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">6</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span></span></span></span></td>
</tr>
<tr>
<td>C</td>
<td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>21</mn></msup></mrow><annotation encoding="application/x-tex">2^{21}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span></td>
<td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>8</mn></msup><mo>−</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">2^8-2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.897438em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">8</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span></span></span></span></td>
</tr>
</tbody></table>
</li>
<li><p>B |10|网络号（14）|主机号（16）|</p>
</li>
<li><p>C |110|网络号（21）|主机号（8）|</p>
</li>
<li><p>D</p>
</li>
<li><p>特殊ip地址</p>
<ol>
<li>主机号全为0，表示本网络本身</li>
<li>主机号全为1，表示本网络广播地址（又称<strong>直接广播地址</strong>）</li>
<li><strong>127.x.x.x保留为环回自检（环回测试）地址</strong>，表示任意主机本身，以此为目的地址的数据报不会出现在任何网络上</li>
<li>32位全为0，表示本网络上的本主机</li>
<li>32位全为1，表示整个TCP&#x2F;IP网络的广播地址，又称<strong>受限广播地址</strong></li>
</ol>
</li>
</ol>
</li>
<li><p>传播类型：</p>
<ol>
<li>组播型地址<ol>
<li>D类地址从 224.0.0.0—239.255.255.255</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
<li><p>网络地址转换（NAT)：将专用网络地址转换为公用网络地址，从而对外隐藏内部管理的ip地址。</p>
<ol>
<li><p>优势：整个专用网对外只需要一个全球ip地址，对内本地ip可重用，大大节省了ip地址的消耗。同时因隐藏了内部网络结构，使内部网络不易受到攻击。（<strong>节省ip，更加安全</strong>）</p>
</li>
<li><p>采用私有ip地址的互联网络称为专用互联网或本地互联网，私有ip也称可重用地址</p>
<ul>
<li>A: 1个网段，即10.0.0.0~10.255.255.255</li>
<li>B: 16个网段，即172.16.0.0~172.31.255.255</li>
<li>C: 256个网段，即192.168.0.0~192.168.255.255</li>
<li><strong>上述地址均不可以在外部网络中出现!!!</strong></li>
</ul>
</li>
<li><p>工作流程：</p>
<ol>
<li>用户主机向网络服务器发送请求。</li>
<li>NAT路由器收到ip分组后，为该ip分组生成一个新端口号，将ip分组的源地址改为NAT路由器的全球ip地址，并在NAT转换表中加入用户主机的信息</li>
<li>服务器发回ip分组时，NAT路由器将ip分组的目的ip地址更改回用户主机的本地ip地址，并发出。</li>
</ol>
</li>
<li><p>注意：NAT路由器不完全工作在网络层，还<strong>需要对接传输层</strong></p>
</li>
</ol>
</li>
</ol>
<h2><span id="433-子网划分与子网掩码-cidr">4.3.3 子网划分与子网掩码、CIDR</span></h2><blockquote>
<p>注意：子网划分时，默认要将所有地址全部分配完毕</p>
</blockquote>
<h3><span id="1-子网划分">1. 子网划分</span></h3><p>在ip地址中增加一个“子网号字段”，使两级ip地址变更为三级ip地址，是因特网的一个正式标准协议</p>
<p><strong>基本思路 basic idea</strong></p>
<ol>
<li>对内划分，对外视为整体，<strong>减小广播域</strong></li>
<li>从主机号借用若干比特作为子网号，三级ip地址的结构：**{网络号，子网号，主机号}**</li>
<li>外来数据报先送达本单位的路由器，再由路由器找到目的子网，最后把ip数据报发送给目的主机</li>
</ol>
<p><strong>注意事项</strong></p>
<ol>
<li>对外部网络来说，并不知道网络内部是否进行了子网划分</li>
</ol>
<h3><span id="2-子网掩码">2. 子网掩码</span></h3><p>使用子网掩码来表示对原网络中主机号的借位</p>
<p>子网掩码与IP地址进行诸位”与”运算后得到该主机所在子网的网络号</p>
<p>ABC三类地址的默认子网掩码：</p>
<p>255.0.0.0</p>
<p>255.255.0.</p>
<p>255.255.255.0</p>
<p>在网络使用子网掩码的情况下：</p>
<ol>
<li>一台主机在设置ip地址信息的同时，必须设置子网掩码</li>
<li>同属于一个子网的所有主机和路由器的相应端口，必须设置相同的子网掩码</li>
<li>路由器的路由表中包含的主要信息有：网络地址，子网掩码，下一跳地址</li>
</ol>
<h3><span id="3-无分类编址cidr">3. 无分类编址（CIDR）</span></h3><p>CIDR消除了传统A、B、C类地址以及划分子网的概念，使用“网络前缀”代替子网络的概念与传统分类ip地址的最大区别在于前缀的长度并不固定，ip记法为{网络前缀，主机号}，表示为{网络前缀&#x2F;网络前缀长度}</p>
<p>网络前缀都相同的ip地址组成CIDR地址块，内部用掩码确认网络前缀，构造超网（或路由聚集）</p>
<h3><span id="4-网络层转发分组的过程">4. 网络层转发分组的过程</span></h3><p>前提：在转发表中，每条路由都有如下两条信息：（目的网络，下一跳地址）</p>
<p>采用CIDR编址时，如果一个分组在转发表中可以找到多个匹配的前缀，那么应当选择前缀最长的一个座位匹配的前缀（称为<strong>最长前缀匹配</strong>，因为网络前缀越长其地址块就越小，包含的子网也越少）</p>
<p><strong>路由器执行的分组转发算法</strong></p>
<ol>
<li>获取目的主机的IP地址</li>
<li>若查找到特定路由（主机与默认路由），就按照这条路由的下一跳转发分组；否则从转发表的下一条（按前缀长度降序）开始检查，执行步骤3</li>
<li>将子网掩码和IP地址计算的到的前缀与本行收到的前缀进行比对，匹配，则按照”下一跳“进行处理（发到本网络内的主机或其他的路由器）否则，若转发表还有下一行，对下一行进行2,3步骤，否则，执行步骤4</li>
<li>若转发表中有一个默认路由，则把分组转发给默认路由；否则，报告转发分组出错</li>
</ol>
<p><strong>在不同网络中传送数据报时，MAC帧中的源地址和目的地址都要发生变化，IP源地址和目的地址时始终不变</strong></p>
<h2><span id="434-arp-dhcp-icmp">4.3.4 ARP、DHCP、ICMP</span></h2><h3><span id="1-ip地址与硬件地址">1. IP地址与硬件地址</span></h3><p>ip地址对于数据链路层不可见，是先转发到达目标LAN后，先封装为MAC帧后通过数据链路层按MAC地址以广播方式寻址。</p>
<h3><span id="2-地址解析协议arp">2. 地址解析协议（ARP）</span></h3><p>每台主机配有一个ARP高速缓存，用于存放本局域网上各主机和路由器的IP地址到MAC地址的映射，使用ARP来维护这个表。</p>
<p><strong>工作原理</strong></p>
<p><strong>ARP工作在网络层</strong></p>
<ol>
<li>主机A欲向本LAN上的某主机B发送IP数据报，先在其ARP高速缓存中查看有无主机B的IP地址。<ul>
<li>有，查出对应MAC地址并写入MAC帧，通过局域网将该MAC帧发往此MAC地址</li>
<li>无，通过使用目的MAC为FF-FF-FF-FF-FF-FF的帧来封装并广播ARP请求分组，使同一局域网的所有主机都收到此ARP请求。主机B收到后，返回给主机A ARP响应分组，分组中包含主机B的IP与MAC地址的映射关系，主机A将此信息写入ARP缓存然后发送MAC帧</li>
</ul>
</li>
</ol>
<p>asp看到了IP地址，所以工作在网络层；nat看到了端口，所以工作在传输层&#96;</p>
<h3><span id="3-动态主机配置协议dhcp">3. 动态主机配置协议（DHCP）</span></h3><p><strong>用于给主机动态地分配IP地址，是应用层的协议，基于UDP，但是涉及IP地址，所以放到网络层介绍</strong></p>
<p>默认网关：决定当子网内的数据报需要发出这个子网时，需要送到哪一个接口上进行转发的路由器，其ip地址就是默认网关</p>
<blockquote>
<p>已知ip地址和子网掩码，如何求出默认网关?</p>
<p>默认网关是网络地址的最后一个IP地址（常用的默认网关地址通常是主机号所有bit置1后再减去1）。</p>
</blockquote>
<p><strong>工作原理</strong></p>
<ol>
<li><p>客户端发广播寻找DHCP服务器，希望请求到一个ip地址。[此时源ip地址为0.0.0.0， 目的地址为255.255.255.255]</p>
</li>
<li><p>DHCP服务器单播回复客户端（Offer报文，包含分配给客户端的ip地址, 子网掩码，默认网关，DNS服务器地址）</p>
</li>
<li><p>客户端获取到这个ip，发广播给网洛的所有成员，一方面是为了确认请求这个地址，另一个方面也是告诉其他的dhcp服务器自己有地址用了</p>
</li>
<li><p>服务器发送ACK包与客户端握手</p>
</li>
</ol>
<h3><span id="4-网际控制报文协议icmp">4. 网际控制报文协议（ICMP)</span></h3><p>为提高IP数据报交付成功的机会，在网络层使用了ICMP协议来让主机或路由器报告差错和异常情况。</p>
<p><strong>ICMP报文分种类：</strong></p>
<ol>
<li>差错报文<ol>
<li>类型：<ol>
<li>终点不可达 当<strong>路由器或主机</strong>不能交付数据报时，就向源点发送终点不可达报文</li>
<li>源点抑制 当<strong>路由器或主机</strong>因为拥塞丢包时，向源点发送源点抑制报文，令源点发送速率放缓</li>
<li>超时 当<strong>路由器</strong>收到生存时间为0的报文时，除丢弃该数据包外还要向源点发送超时报文。当终点在规定时间内不能完全收到一个数据报时，就把已收到的数据报片全部丢弃，并向源点发送超时报文</li>
<li>参数问题 当<strong>路由器或主机</strong>收到的数据报的<strong>首部</strong>有字段的值不正确时，丢弃该数据报，并向源点发送参数问题报文</li>
<li>改变路由（重定向） 路由器把改变路由报文发送给主机让主机知道下次应将数据报发送给另外的路由器</li>
</ol>
</li>
<li>以下情况不发送差错报告报文<ol>
<li>出差错的是ICMP差错报告报文</li>
<li>对已发送报文的第一个分片的数据报片的所有后续数据报片都不发送ICMP差错报文</li>
<li>具有组播地址的数据报片</li>
<li>对本机地址或默认地址的数据报不发送ICMP差错报告报文</li>
</ol>
</li>
</ol>
</li>
<li>询问报文<ol>
<li><strong>回送请求和回答报文</strong> PING</li>
<li><strong>时间戳请求和回答报文</strong></li>
<li>地址掩码请求和回答报文</li>
<li>路由器询问和通告报文</li>
</ol>
</li>
</ol>
<h1><span id="45-路由协议">4.5 路由协议</span></h1><h2><span id="451-自治系统">4.5.1 自治系统</span></h2><p>单一技术管理下的一组路由器，这些路由器使用一种<strong>AS内部的路由选择协议</strong>和<strong>共同的度量</strong>来确定分组在该AS内的路由，同时还使用一种AS之间的路由选择协议来确定分组在AS之间的路由。</p>
<p>一个自治系统的所有路由器在本自治系统内都必须是连通的。</p>
<h2><span id="452-域内路由与域间路由">4.5.2 域内路由与域间路由</span></h2><ol>
<li>内部网关协议<ol>
<li>在一个自治系统内使用的路由选择协议，它与互联网中其他自治系统选用的路由选择协议无关。如RIP和OSPF</li>
</ol>
</li>
<li>外部网关协议<ol>
<li>不同自治系统之间进行格式转换和信息传输的协议，如BGP-4</li>
</ol>
</li>
</ol>
<h2><span id="453-路由信息协议rip">4.5.3 路由信息协议(RIP)</span></h2><p>简单的路由选择协议，是<strong>应用层的协议</strong></p>
<h3><span id="1-rip规定">1. RIP规定</span></h3><ol>
<li>每个路由器维护从自身到其他目的网络的距离记录（或称为距离向量）</li>
<li>跳数是RIP协议下的距离度量</li>
<li>RIP优先选择跳数最短的路径</li>
<li>RIP允许的最大跳数为15跳。距离大于等于16跳的网络视为不可达网络</li>
<li>默认在任意两个路由器之间每30秒广播一次RIP路由更新信息，以便动态维护路由表</li>
<li><del>不支持子网掩码的RIP广播（但改进的RIP2中得到了支持）</del></li>
</ol>
<h3><span id="2-rip的特点">2. RIP的特点</span></h3><ol>
<li><strong>仅和相邻路由器交换信息</strong></li>
<li>记录了所有路由器的路由表，并根据路由表信息计算路径</li>
<li>按固定时间间隔交换路由信息（不会发生碰撞吗？</li>
<li>坏消息传得慢（<strong>距离远的信息会比距离近的信息晚到达源主机</strong></li>
</ol>
<h3><span id="3-距离向量算法">3. 距离向量算法</span></h3><p>有点递归计算的意味</p>
<p><strong>信息交换过程</strong></p>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mi><mover><mo><mo><munder><mo><mo>⇌</mo></mo><mrow><mtext>返回所有路由表项</mtext><mo stretchy="false">(</mo><mi>R</mi><mi>I</mi><mi>P</mi><mtext>报文</mtext><mo stretchy="false">)</mo></mrow></munder></mo></mo><mtext>请求路由信息</mtext></mover></mi><mi>B</mi><mi><mover><mo><mo><munder><mo><mo>⇌</mo></mo><mtext>返回所有路由表项</mtext></munder></mo></mo><mtext>请求路由信息</mtext></mover></mi><mi>C</mi><mi><mover><mo><mo><munder><mo><mo>⇌</mo></mo><mtext>返回所有路由表项</mtext></munder></mo></mo><mtext>请求路由信息</mtext></mover></mi><mi>D</mi></mrow><annotation encoding="application/x-tex">A\overset{请求路由信息}{\underset{返回所有路由表项(RIP报文)}{\rightleftharpoons}}B\overset{请求路由信息}{\underset{返回所有路由表项}{\rightleftharpoons}}C\overset{请求路由信息}{\underset{返回所有路由表项}{\rightleftharpoons}}D</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.4263310000000002em;vertical-align:-0.977em;"></span><span class="mord mathnormal">A</span><span class="mord"><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4493310000000004em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop"><span class="mrel"><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.671em;"><span style="top:-2.298em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord cjk_fallback mtight">返</span><span class="mord cjk_fallback mtight">回</span><span class="mord cjk_fallback mtight">所</span><span class="mord cjk_fallback mtight">有</span><span class="mord cjk_fallback mtight">路</span><span class="mord cjk_fallback mtight">由</span><span class="mord cjk_fallback mtight">表</span><span class="mord cjk_fallback mtight">项</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span><span class="mord mathnormal mtight" style="margin-right:0.07847em;">I</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span><span class="mord cjk_fallback mtight">报</span><span class="mord cjk_fallback mtight">文</span><span class="mclose mtight">)</span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop">⇌</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.977em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.8710000000000004em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord cjk_fallback mtight">请</span><span class="mord cjk_fallback mtight">求</span><span class="mord cjk_fallback mtight">路</span><span class="mord cjk_fallback mtight">由</span><span class="mord cjk_fallback mtight">信</span><span class="mord cjk_fallback mtight">息</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.977em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mord"><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.449331em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop"><span class="mrel"><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.671em;"><span style="top:-2.344669em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord cjk_fallback mtight">返</span><span class="mord cjk_fallback mtight">回</span><span class="mord cjk_fallback mtight">所</span><span class="mord cjk_fallback mtight">有</span><span class="mord cjk_fallback mtight">路</span><span class="mord cjk_fallback mtight">由</span><span class="mord cjk_fallback mtight">表</span><span class="mord cjk_fallback mtight">项</span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop">⇌</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.755331em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.871em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord cjk_fallback mtight">请</span><span class="mord cjk_fallback mtight">求</span><span class="mord cjk_fallback mtight">路</span><span class="mord cjk_fallback mtight">由</span><span class="mord cjk_fallback mtight">信</span><span class="mord cjk_fallback mtight">息</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.755331em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord"><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.449331em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop"><span class="mrel"><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.671em;"><span style="top:-2.344669em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord cjk_fallback mtight">返</span><span class="mord cjk_fallback mtight">回</span><span class="mord cjk_fallback mtight">所</span><span class="mord cjk_fallback mtight">有</span><span class="mord cjk_fallback mtight">路</span><span class="mord cjk_fallback mtight">由</span><span class="mord cjk_fallback mtight">表</span><span class="mord cjk_fallback mtight">项</span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop">⇌</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.755331em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.871em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord cjk_fallback mtight">请</span><span class="mord cjk_fallback mtight">求</span><span class="mord cjk_fallback mtight">路</span><span class="mord cjk_fallback mtight">由</span><span class="mord cjk_fallback mtight">信</span><span class="mord cjk_fallback mtight">息</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.755331em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span></span>

<p><strong>计算最优路线</strong></p>
<blockquote>
<p>简而言之，递归生成距离向量，与邻接路由器分享路由表最终处理成自己的路由表和距离向量</p>
</blockquote>
<ol>
<li>对于相邻路由器<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">X_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>发来的RIP报文，先修改此报文中的所有项目：把下一跳地址改为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">X_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，并把所有表项的距离字段值+1</li>
<li>对于收到的修改后的RIP报文<ol>
<li>如果自身的路由表中没有目的网络N，加入该表项</li>
<li>如果有目的网络N，且下一跳的路由器是<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">X_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，用收到的项目替换表中的项目</li>
<li>如果有目的网络N，但下一跳的路由器不是<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">X_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，选出跳数最小的一项留在路由表中</li>
</ol>
</li>
<li>如果180秒（默认超时时间）还没有收到相邻路由器的RIP报文，把这个路由器划分到不可达路由器范围内，</li>
<li>返回</li>
</ol>
<p><strong>RIP的缺点</strong></p>
<ol>
<li>规模小</li>
<li>路由器之间交换的是完整的路由表，网络开销较大</li>
<li>网络出现故障时，会发生慢收敛现象（需要较长时间才能把信息传到所有的路由器），使更新过程的消耗时间变长</li>
</ol>
<h2><span id="454-开放最短路径优先协议ospf">4.5.4 开放最短路径优先协议（OSPF)</span></h2><blockquote>
<p>通过广播邻接状态（包括邻接路由以及代价），生成网络拓扑</p>
</blockquote>
<h3><span id="基本特点">基本特点</span></h3><ol>
<li>OSPF是广播式交换信息，每个路由器向本自治系统中的所有路由器发送信息</li>
<li>发送的信息是与本路由器相邻的路由器的状态</li>
<li>只有当链路状态变化时，才会向其他路由器广播（与某个网络协议类似?)</li>
<li><strong>网络层协议</strong>，直接使用ip数据报进行数据传输（其数据报首部的协议字段为89）</li>
<li>对不同的链路可根据IP分组的不同服务类型（TOS)而设置成不同代价。因此可以按不同的业务计算不同的路由，<strong>更加灵活</strong></li>
<li><strong>可平均分配网络负载</strong>，如果有多条同样代价的路由，可以将通信量分配给这些路由</li>
<li>具有安全检验功能CIDR</li>
<li>每个链路都带上一个32位的序号，<strong>序号越大，链路越新</strong></li>
</ol>
<h3><span id="基本工作原理">基本工作原理</span></h3><p>dijkstra算法计算最短路径（但路由表仍然记录的是下一跳的路由地址）</p>
<p>自治系统内继续划分区域，这些区域也有层次之分</p>
<h3><span id="五种分组类型">五种分组类型</span></h3><ol>
<li>问候分组：发现和维持邻站的可达性。通常每10s每相邻两个路由器需要交换一次问候分组</li>
<li>数据库描述分组：描述自身数据库中所有链路状态项目的摘要信息</li>
<li>链路状态请求分组：</li>
<li>链路状态更新分组：</li>
<li>链路状态确认分组</li>
</ol>
<p><img data-fancybox="gallery" data-sizes="auto" data-src="/kirameki/%E8%AE%A1%E7%BD%91%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%B1%82/image-20230313144330273.png" alt="image-20230313144330273" class="lazyload"></p>
<h2><span id="455-边界网关协议bgp">4.5.5 边界网关协议（BGP）</span></h2><p>是不同自治系统的路由器之间交换路由信息的协议，是一种基于TCP的外部网关协议，处在应用层</p>
<blockquote>
<p>路径信息作为可达性的判定因素</p>
</blockquote>
<p><strong>面临的困境</strong></p>
<ul>
<li>因特网规模太大</li>
<li>寻找最佳路由很不现实</li>
</ul>
<p><strong>解决方案</strong> 不要求最优路线，只需要较优路线</p>
<p><strong>工作原理</strong></p>
<p>每个自治系统的管理员需要选择至少一个路由器作为该自治系统的BGP发言人，BGP发言人与其他自治系统的发言人<strong>建立TCP连接，交换路由信息</strong></p>
<p><img data-fancybox="gallery" data-sizes="auto" data-src="/kirameki/%E8%AE%A1%E7%BD%91%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%B1%82/image-20230313150218555.png" alt="image-20230313150218555" class="lazyload"></p>
<hr>
<p><img data-fancybox="gallery" data-sizes="auto" data-src="/kirameki/%E8%AE%A1%E7%BD%91%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%B1%82/image-20230313150253363.png" alt="image-20230313150253363" class="lazyload"></p>

	</article>

	 
    <div class="kira-post-copyright">
        <strong>本文作者：</strong>Kiryu Sento<br>
        <strong>本文链接：</strong><a href="https://wandernforte.github.io/kirameki/%E8%AE%A1%E7%BD%91%EF%BC%9A%E7%BD%91%E7%BB%9C%E5%B1%82/" title="https:&#x2F;&#x2F;wandernforte.github.io&#x2F;kirameki&#x2F;计网：网络层&#x2F;" target="_blank" rel="noopener">https:&#x2F;&#x2F;wandernforte.github.io&#x2F;kirameki&#x2F;计网：网络层&#x2F;</a><br>
        
            <strong>版权声明：</strong>本文采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/cn/deed.zh" target="_blank">CC BY-NC-SA 3.0 CN</a> 协议进行许可
        
    </div>

  
	<div class="kira-post-nav">
		<nav class="post-nav">
			  
			<!-- 先找到与当前文字相同的目录 -->
			               
			<!-- 在找到当前文章所在的 index -->
			                
			<!-- 上一篇文章 -->
			<div class="old">
				<span>上一章</span>
				<a href="/kirameki/%E8%AE%A1%E7%BD%91%EF%BC%9A%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82/"> 计网：数据链路层</a>
			</div>
			       
			<!-- 下一篇文章 -->
			<div class="new">
				<span>下一章</span>
				<a href="/kirameki/Transition-Layer/"> 计网：传输层</a>
			</div>
			                                    
		</nav>
	</div>
	
	<div class="kira-post-meta kira-rainbow">
		
			<a class="kirafont icon-appstore-fill -link" href="/kirameki/categories/Computer-Network/">Computer Network</a>
		
		
			<a class="kirafont icon-tag-fill -none-link" href="/kirameki/tags/note/" rel="tag">note</a>
		
	</div>
	
		<script src="/js/kira-code-copy.js"></script>
	

</div>
				</div>
			</div>
			<div class="kira-right-column">
	<a onclick="document.querySelector('#kira-top-header').scrollIntoView({behavior: 'smooth'});" class="kira-backtotop" aria-label="回到顶部" title="回到顶部">
		<button class="mdui-fab mdui-ripple">
			<i class="kirafont icon-caret-up"></i>
		</button>
	</a>
</div>

		</div>
	</body>
</html>
